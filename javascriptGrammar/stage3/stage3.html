<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>Todo v0.4 - Stage 3</title>
    <style>
        body { font-family: system-ui, sans-serif; }
        .done { text-decoration: line-through; color: gray; }
        .filter.active { font-weight: bold; }
    </style>
</head>
<body>
<h2>í•  ì¼ ëª©ë¡</h2>

<!-- â‘  ì…ë ¥ í¼ -->
<input id="input-title" placeholder="í•  ì¼ì„ ì…ë ¥í•˜ì„¸ìš”" />
<button id="btn-add">ì¶”ê°€</button>

<!-- (a) í•„í„° UI -->
<button data-view="all" class="filter active">ì „ì²´</button>
<button data-view="active" class="filter">ë¯¸ì™„ë£Œ</button>
<button data-view="completed" class="filter">ì™„ë£Œ</button>

<!-- â‘¡ ëª©ë¡ -->
<ul id="todo-list"></ul>

<p id="summary"></p>

<script>
    /***** ì „ì—­ ìƒíƒœ *****/
    let nextId = 1;
    let tasks = load();
    let viewMode = 'all';

    const save = () => localStorage.setItem('tasks', JSON.stringify(tasks));
    function load() {
        try {
            return JSON.parse(localStorage.getItem('tasks')) ?? [];
        } catch {return [];}
    }

    const makeTask = (title) => ({id: nextId++, title, done: false});

    const getFiltered = () => ({
        all: tasks,
        active: tasks.filter(t => !t.done),
        completed: tasks.filter(t => t.done),
    }[viewMode]);

    const addTask = (title) => { tasks = [...tasks, makeTask(title)]}
    const toggleTask = (id) => {
        tasks = tasks.map(t => t.id === id ? {...t, done: !t.done} : t);
    };
    const removeTask = (id) => {
        tasks = tasks.filter(t => t.id !== id);
    };

    function render() {
        const ul = document.querySelector('#todo-list');
        ul.innerHTML = '';

        for (const {id, title, done} of getFiltered()) {
            const li = document.createElement('li');
            li.dataset.id = id;
            li.textContent = title ?? '(ì œëª© ì—†ìŒ)';
            if (done) li.classList.add('done');

            const delBtn = document.createElement('button');
            delBtn.textContent = 'ğŸ—‘ï¸';
            delBtn.className = 'btn-del';
            li.append(delBtn);
            ul.append(li);
        }

        const { todo } = tasks.reduce(
            (acc, { done }) => done ? {...acc, done: acc.done + 1} : {...acc, todo: acc.todo + 1},
            {done: 0, todo: 0}
        );
        document.querySelector('#summary').textContent = todo ? `ğŸ—’ï¸ ë‚¨ì€ ì¼: ${todo}ê°œ` : 'ğŸ‰ ëª¨ë‘ ì™„ë£Œ!';

        /* (3) í•„í„° ìƒíƒœ í‘œì‹œ */
        document.querySelectorAll('.filter').forEach(btn => btn.classList.toggle('active', btn.dataset.view === viewMode));
    }

    /***** ì…ë ¥ ì¶”ê°€ *****/
    document.querySelector('#btn-add').addEventListener('click', () => {
        const input = document.querySelector('#input-title');
        const title = input.value.trim();
        if (!title) return alert('ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”!');
        if (tasks.some(t => t.title === title))
            return alert('ì´ë¯¸ ê°™ì€ ì œëª©ì´ ìˆì–´ìš”!');
        addTask(title); save(); render();
        input.value = '';
    });

    /***** (A) ì´ë²¤íŠ¸ ìœ„ì„: í† ê¸€ & ì‚­ì œ *****/
    document.querySelector('#todo-list')
        .addEventListener('click', e => {
            const li = e.target.closest('li');
            if (!li) return;
            const id = Number(li.dataset.id);

            e.target.classList.contains('btn-del') ? removeTask(id) : toggleTask(id);

            save(); render();
        });

    /***** (B) í•„í„° ë²„íŠ¼ í´ë¦­ *****/
    document
        .querySelectorAll('.filter')
        .forEach(btn => btn.addEventListener('click', () => {
            viewMode = btn.dataset.view;
            render();
        }));


    /***** ìµœì´ˆ ë Œë” *****/
    render();
</script>
</body>
</html>
